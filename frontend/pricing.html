<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pricing - Permabullish</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=DM+Serif+Display&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'DM Sans', system-ui, sans-serif;
            background: linear-gradient(135deg, #102a43 0%, #1e3a5f 100%);
            min-height: 100vh;
        }
        .font-display { font-family: 'DM Serif Display', Georgia, serif; }
        .card-gradient { background: linear-gradient(to bottom right, #1e3a5f, #243b53); }
        .popular-badge {
            background: linear-gradient(135deg, #e8913a 0%, #d97316 100%);
        }
    </style>
</head>
<body class="text-white">
    <!-- Navigation -->
    <nav class="py-4 px-6">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <a href="index.html" class="text-2xl font-display">Permabullish</a>
            <div class="flex items-center space-x-4">
                <a href="dashboard.html" class="text-[#9fb3c8] hover:text-white transition-colors">Dashboard</a>
                <a href="generate.html" class="bg-[#e8913a] hover:bg-[#d97316] px-4 py-2 rounded-lg transition-colors">
                    Generate Report
                </a>
            </div>
        </div>
    </nav>

    <!-- Hero -->
    <section class="py-12 px-6 text-center">
        <h1 class="text-4xl md:text-5xl font-display mb-4">Simple, Transparent Pricing</h1>
        <p class="text-xl text-[#9fb3c8] max-w-2xl mx-auto">
            Get AI-powered stock research reports at a fraction of the cost of traditional research services.
        </p>
    </section>

    <!-- Billing Toggle -->
    <div class="flex justify-center mb-8 px-4">
        <div class="bg-[#243b53] rounded-lg p-1 inline-flex flex-wrap sm:flex-nowrap justify-center relative gap-1">
            <button id="monthlyBtn" onclick="setBillingPeriod('monthly')"
                class="px-3 sm:px-4 py-2 rounded-md text-xs sm:text-sm font-medium transition-all billing-btn">
                Monthly
            </button>
            <button id="6monthsBtn" onclick="setBillingPeriod('6months')"
                class="px-3 sm:px-4 py-2 rounded-md text-xs sm:text-sm font-medium transition-all billing-btn whitespace-nowrap">
                6 Months <span class="text-green-400 text-xs ml-1">-17%</span>
            </button>
            <button id="yearlyBtn" onclick="setBillingPeriod('yearly')"
                class="px-3 sm:px-4 py-2 rounded-md text-xs sm:text-sm font-medium transition-all billing-btn relative whitespace-nowrap">
                Yearly <span class="bg-green-500 text-white text-xs px-1.5 sm:px-2 py-0.5 rounded-full ml-1 font-bold">-30%</span>
            </button>
            <!-- Best Value badge -->
            <div class="absolute -top-3 right-0 bg-green-500 text-white text-xs px-2 py-0.5 rounded-full font-bold shadow-lg hidden sm:block">
                Best Value
            </div>
        </div>
    </div>

    <!-- Pricing Cards -->
    <section class="py-8 px-6">
        <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- Free -->
            <div id="freeTierCard" class="card-gradient rounded-2xl border border-[#334e68] p-6 flex flex-col">
                <h3 class="text-xl font-semibold mb-2">Free</h3>
                <p class="text-[#9fb3c8] text-sm mb-4">Try out AI stock research</p>
                <div class="mb-6">
                    <span class="text-4xl font-bold">₹0</span>
                    <span class="text-[#9fb3c8]">/forever</span>
                </div>
                <ul class="space-y-3 mb-8 flex-grow">
                    <li class="flex items-center text-sm">
                        <svg class="w-5 h-5 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span><strong>3 reports</strong> (lifetime)</span>
                    </li>
                    <li class="flex items-center text-sm">
                        <svg class="w-5 h-5 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span>Full AI analysis</span>
                    </li>
                    <li class="flex items-center text-sm">
                        <svg class="w-5 h-5 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span>Watchlist</span>
                    </li>
                </ul>
                <button onclick="selectPlan('free')" class="w-full py-3 border border-[#334e68] rounded-lg hover:bg-[#334e68] transition-colors">
                    Current Plan
                </button>
            </div>

            <!-- Basic -->
            <div class="card-gradient rounded-2xl border border-[#334e68] p-6 flex flex-col">
                <h3 class="text-xl font-semibold mb-2">Basic</h3>
                <p class="text-[#9fb3c8] text-sm mb-4">For casual investors</p>
                <div class="mb-6">
                    <span class="text-4xl font-bold" id="basicPrice">₹2,499</span>
                    <span class="text-[#9fb3c8]" id="basicPeriod">/year</span>
                    <div id="basicMonthlyEquiv" class="text-green-400 text-sm mt-1 font-medium">Just ₹208/month</div>
                </div>
                <ul class="space-y-3 mb-8 flex-grow">
                    <li class="flex items-center text-sm">
                        <svg class="w-5 h-5 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span><strong>10 reports</strong>/month</span>
                    </li>
                    <li class="flex items-center text-sm">
                        <svg class="w-5 h-5 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span>Full AI analysis</span>
                    </li>
                    <li class="flex items-center text-sm">
                        <svg class="w-5 h-5 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span>Watchlist</span>
                    </li>
                    <li class="flex items-center text-sm">
                        <svg class="w-5 h-5 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span>Report history</span>
                    </li>
                </ul>
                <button onclick="selectPlan('basic')" class="w-full py-3 bg-[#243b53] hover:bg-[#334e68] rounded-lg transition-colors">
                    Get Started
                </button>
            </div>

            <!-- Pro (Popular) -->
            <div class="card-gradient rounded-2xl border-2 border-[#e8913a] p-6 flex flex-col relative">
                <div class="popular-badge absolute -top-3 left-1/2 -translate-x-1/2 px-4 py-1 rounded-full text-sm font-medium">
                    Most Popular
                </div>
                <h3 class="text-xl font-semibold mb-2 mt-2">Pro</h3>
                <p class="text-[#9fb3c8] text-sm mb-4">For active traders</p>
                <div class="mb-6">
                    <span class="text-4xl font-bold" id="proPrice">₹6,999</span>
                    <span class="text-[#9fb3c8]" id="proPeriod">/year</span>
                    <div id="proMonthlyEquiv" class="text-green-400 text-sm mt-1 font-medium">Just ₹583/month</div>
                </div>
                <ul class="space-y-3 mb-8 flex-grow">
                    <li class="flex items-center text-sm">
                        <svg class="w-5 h-5 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span><strong>50 reports</strong>/month</span>
                    </li>
                    <li class="flex items-center text-sm">
                        <svg class="w-5 h-5 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span>Full AI analysis</span>
                    </li>
                    <li class="flex items-center text-sm">
                        <svg class="w-5 h-5 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span>Priority generation</span>
                    </li>
                    <li class="flex items-center text-sm">
                        <svg class="w-5 h-5 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span>Watchlist & history</span>
                    </li>
                </ul>
                <button onclick="selectPlan('pro')" class="w-full py-3 bg-[#e8913a] hover:bg-[#d97316] rounded-lg transition-colors font-medium">
                    Get Pro
                </button>
            </div>

            <!-- Enterprise -->
            <div class="card-gradient rounded-2xl border border-[#334e68] p-6 flex flex-col">
                <h3 class="text-xl font-semibold mb-2">Enterprise</h3>
                <p class="text-[#9fb3c8] text-sm mb-4">For institutions & advisors</p>
                <div class="mb-6">
                    <span class="text-4xl font-bold">Custom</span>
                </div>
                <ul class="space-y-3 mb-8 flex-grow">
                    <li class="flex items-center text-sm">
                        <svg class="w-5 h-5 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span><strong>Unlimited</strong> reports</span>
                    </li>
                    <li class="flex items-center text-sm">
                        <svg class="w-5 h-5 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span>API access</span>
                    </li>
                    <li class="flex items-center text-sm">
                        <svg class="w-5 h-5 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span>Dedicated support</span>
                    </li>
                    <li class="flex items-center text-sm">
                        <svg class="w-5 h-5 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span>Custom integrations</span>
                    </li>
                </ul>
                <a href="mailto:enterprise@permabullish.com" class="w-full py-3 border border-[#334e68] rounded-lg hover:bg-[#334e68] transition-colors text-center block">
                    Contact Us
                </a>
            </div>
        </div>
    </section>

    <!-- FAQ -->
    <section class="py-16 px-6">
        <div class="max-w-3xl mx-auto">
            <h2 class="text-3xl font-display text-center mb-12">Frequently Asked Questions</h2>
            <div class="space-y-6">
                <div class="card-gradient rounded-xl p-6 border border-[#334e68]">
                    <h3 class="font-semibold mb-2">What counts as a report?</h3>
                    <p class="text-[#9fb3c8] text-sm">Each unique stock analysis counts as one report. Viewing a cached report (generated by you or others within 15 days) is free. Regenerating an outdated report counts against your quota.</p>
                </div>
                <div class="card-gradient rounded-xl p-6 border border-[#334e68]">
                    <h3 class="font-semibold mb-2">Do unused reports roll over?</h3>
                    <p class="text-[#9fb3c8] text-sm">No, monthly reports reset on the 1st of each month. Free tier reports are a one-time lifetime allocation.</p>
                </div>
                <div class="card-gradient rounded-xl p-6 border border-[#334e68]">
                    <h3 class="font-semibold mb-2">Can I upgrade or downgrade anytime?</h3>
                    <p class="text-[#9fb3c8] text-sm">Yes! You can upgrade anytime and the new limits apply immediately. Downgrades take effect at the end of your current billing period.</p>
                </div>
                <div class="card-gradient rounded-xl p-6 border border-[#334e68]">
                    <h3 class="font-semibold mb-2">What payment methods do you accept?</h3>
                    <p class="text-[#9fb3c8] text-sm">We accept UPI, credit/debit cards, and net banking through our payment partner Cashfree.</p>
                </div>
            </div>
        </div>
    </section>

    <script src="config.js"></script>
    <script>
        const pricing = {
            basic: { monthly: 299, '6months': 1499, yearly: 2499 },
            pro: { monthly: 799, '6months': 3999, yearly: 6999 }
        };

        // Monthly equivalents (pre-calculated)
        const monthlyEquiv = {
            basic: { '6months': 250, yearly: 208 },
            pro: { '6months': 667, yearly: 583 }
        };

        let currentPeriod = 'yearly';  // Default to yearly (best value)
        const token = localStorage.getItem('token');

        function setBillingPeriod(period) {
            currentPeriod = period;

            // Update button states
            document.querySelectorAll('.billing-btn').forEach(btn => {
                btn.classList.remove('bg-[#e8913a]', 'text-white');
                btn.classList.add('text-[#9fb3c8]');
            });
            const activeBtn = document.getElementById(period + 'Btn');
            activeBtn.classList.add('bg-[#e8913a]', 'text-white');
            activeBtn.classList.remove('text-[#9fb3c8]');

            // Update prices
            const periodLabel = period === 'monthly' ? '/month' :
                               period === '6months' ? '/6 months' : '/year';

            document.getElementById('basicPrice').textContent = '₹' + pricing.basic[period].toLocaleString('en-IN');
            document.getElementById('basicPeriod').textContent = periodLabel;
            document.getElementById('proPrice').textContent = '₹' + pricing.pro[period].toLocaleString('en-IN');
            document.getElementById('proPeriod').textContent = periodLabel;

            // Update monthly equivalents
            const basicEquivEl = document.getElementById('basicMonthlyEquiv');
            const proEquivEl = document.getElementById('proMonthlyEquiv');

            if (period === 'monthly') {
                basicEquivEl.style.display = 'none';
                proEquivEl.style.display = 'none';
            } else {
                const savings = period === 'yearly' ? '30%' : '17%';
                basicEquivEl.style.display = 'block';
                basicEquivEl.innerHTML = `Just ₹${monthlyEquiv.basic[period]}/month <span class="text-xs opacity-75">(save ${savings})</span>`;
                proEquivEl.style.display = 'block';
                proEquivEl.innerHTML = `Just ₹${monthlyEquiv.pro[period]}/month <span class="text-xs opacity-75">(save ${savings})</span>`;
            }
        }

        async function selectPlan(plan) {
            if (plan === 'free') {
                window.location.href = 'generate.html';
                return;
            }

            if (!token) {
                alert('Please sign in first to subscribe.');
                window.location.href = 'index.html';
                return;
            }

            const periodMonths = currentPeriod === 'monthly' ? 1 :
                                currentPeriod === '6months' ? 6 : 12;

            try {
                const response = await fetch(`${API_BASE}/subscription/checkout?tier=${plan}&period=${periodMonths}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (data.type === 'checkout') {
                    // Redirect to checkout page
                    window.location.href = data.checkout_url;
                } else if (data.type === 'contact') {
                    alert(data.message);
                }
            } catch (error) {
                console.error('Checkout error:', error);
                alert('Failed to initiate checkout. Please try again.');
            }
        }

        // Check subscription status and hide Free tier for logged-in users
        async function checkUserStatus() {
            if (!token) return;

            // Hide Free tier for all logged-in users (they already have an account)
            const freeTierCard = document.getElementById('freeTierCard');
            if (freeTierCard) {
                freeTierCard.style.display = 'none';
            }
            // Adjust grid to 3 columns
            const grid = document.querySelector('.grid.grid-cols-1');
            if (grid) {
                grid.classList.remove('lg:grid-cols-4');
                grid.classList.add('lg:grid-cols-3');
            }

            try {
                const response = await fetch(`${API_BASE}/subscription/status`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const status = await response.json();
                    const tier = status.tier || 'free';

                    // Update button text for current plan (for paying users)
                    if (tier !== 'free') {
                        const currentTierBtn = document.querySelector(`[onclick="selectPlan('${tier}')"]`);
                        if (currentTierBtn) {
                            currentTierBtn.textContent = 'Current Plan';
                            currentTierBtn.classList.remove('bg-[#243b53]', 'bg-[#e8913a]');
                            currentTierBtn.classList.add('bg-green-600', 'cursor-default');
                            currentTierBtn.onclick = null;
                        }
                    }
                }
            } catch (e) {
                console.error('Failed to check subscription status:', e);
            }
        }

        // Initialize with yearly (best value) as default
        setBillingPeriod('yearly');
        checkUserStatus();
    </script>
</body>
</html>
